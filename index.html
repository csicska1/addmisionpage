<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admission QR Code Generator</title>
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #22c55e;
      --accent-2: #60a5fa;
      --danger: #ef4444;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: var(--bg); color: var(--text); }
    header { padding: 16px 20px; border-bottom: 1px solid #1f2937; background: #0b1220; position: sticky; top: 0; z-index: 10; }
    header h1 { margin: 0; font-size: 18px; font-weight: 600; }

    .container { max-width: 960px; margin: 24px auto; padding: 0 16px; }

    .card { background: var(--panel); border: 1px solid #1f2937; border-radius: 12px; padding: 20px; }
    .row { display: flex; flex-wrap: wrap; gap: 16px; }
    .col { flex: 1 1 320px; }

    label { display: block; color: var(--muted); font-size: 12px; margin-bottom: 6px; }
    input[type="text"], select { width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid #1f2937; background: #0b1220; color: var(--text); }
    input::placeholder { color: #6b7280; }

    .actions { display: flex; gap: 10px; margin-top: 12px; flex-wrap: wrap; }
    button { padding: 10px 14px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; }
    .btn-primary { background: var(--accent); color: #052e16; }
    .btn-secondary { background: #1f2937; color: var(--text); border: 1px solid #374151; }
    .btn-danger { background: var(--danger); color: #fee2e2; }

    .preview { display: grid; gap: 12px; place-items: center; }
    .canvas-wrap { background: white; padding: 8px; border-radius: 8px; }
    canvas { image-rendering: pixelated; display: block; }

    .small { color: var(--muted); font-size: 12px; }
    .error { color: #fecaca; background: #7f1d1d; border: 1px solid #991b1b; padding: 8px 10px; border-radius: 8px; }
  </style>
</head>
<body>
  <header>
    <h1>Admission QR Code Generator</h1>
  </header>

  <div class="container">
    <div class="card">
      <div class="row">
        <div class="col">
          <label for="url">Admission URL</label>
          <input id="url" type="text" placeholder="https://your-admission-site.example" autocomplete="on" />
          <div class="actions">
            <button id="btn-generate" class="btn-primary">Generate QR</button>
            <button id="btn-copy" class="btn-secondary" title="Copy URL">Copy URL</button>
            <button id="btn-clear" class="btn-danger" title="Clear">Clear</button>
          </div>
          <div class="row" style="margin-top: 16px;">
            <div class="col">
              <label for="ecl">Error correction</label>
              <select id="ecl">
                <option value="L">L (low)</option>
                <option value="M" selected>M (medium)</option>
                <option value="Q">Q (quartile)</option>
                <option value="H">H (high)</option>
              </select>
            </div>
            <div class="col">
              <label for="scale">Scale</label>
              <select id="scale">
                <option>4</option>
                <option>6</option>
                <option selected>8</option>
                <option>10</option>
                <option>12</option>
                <option>16</option>
              </select>
            </div>
            <div class="col">
              <label for="border">Border</label>
              <select id="border">
                <option>2</option>
                <option selected>4</option>
                <option>8</option>
              </select>
            </div>
          </div>
          <p class="small">Tip: Use H for printed passes; use M for screens. Larger scale makes the image bigger.</p>
          <div id="error" class="error" style="display:none"></div>
        </div>
        <div class="col">
          <div class="preview">
            <div class="canvas-wrap">
              <canvas id="qr"></canvas>
            </div>
            <div class="actions">
              <button id="btn-download" class="btn-secondary">Download PNG</button>
            </div>
            <div class="small" id="meta"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="../qrcodegen/qrcodegen.js"></script>
  <script>
    const $ = (s) => document.querySelector(s);
    const urlEl = $('#url');
    const eclEl = $('#ecl');
    const scaleEl = $('#scale');
    const borderEl = $('#border');
    const canvas = $('#qr');
    const meta = $('#meta');
    const errBox = $('#error');

    function setError(msg) {
      if (!msg) { errBox.style.display = 'none'; errBox.textContent=''; return; }
      errBox.textContent = msg; errBox.style.display = '';
    }

    function generate() {
      try {
        setError('');
        const text = urlEl.value.trim();
        if (!text) { setError('Please enter your admission URL.'); return; }
        // simple validation
        try { new URL(text); } catch (e) { setError('Invalid URL format. Include https://'); return; }

        const ecl = eclEl.value;
        const scale = parseInt(scaleEl.value, 10);
        const border = parseInt(borderEl.value, 10);

        const qr = QRCode.generate(text, { ecl, minVersion: 1, maxVersion: 10 });
        QRCode.renderCanvas(qr, { canvas, scale, border });
        meta.textContent = `Version ${qr.version} • ECL ${qr.ecl} • Size ${qr.size}×${qr.size}`;
      } catch (err) {
        console.error(err);
        setError(err.message || 'Failed to generate QR code.');
      }
    }

    function copyUrl() {
      const text = urlEl.value.trim();
      if (!text) return;
      navigator.clipboard.writeText(text).catch(()=>{});
    }

    function clearAll() {
      urlEl.value=''; meta.textContent=''; setError('');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0,0,canvas.width, canvas.height);
    }

    function download() {
      if (!canvas.width) { setError('Generate a QR code first.'); return; }
      const a = document.createElement('a');
      a.href = canvas.toDataURL('image/png');
      a.download = 'admission-qr.png';
      a.click();
    }

    $('#btn-generate').addEventListener('click', generate);
    $('#btn-copy').addEventListener('click', copyUrl);
    $('#btn-clear').addEventListener('click', clearAll);
    $('#btn-download').addEventListener('click', download);

    // Auto-generate when typing stops
    let t;
    urlEl.addEventListener('input', () => { clearTimeout(t); t = setTimeout(generate, 500); });

    // If there's a URL hash, prefill and generate
    if (location.hash.length > 1) {
      try { urlEl.value = decodeURIComponent(location.hash.slice(1)); } catch {}
      generate();
    }
  </script>
</body>
</html>
