<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QR Code Access Scanner</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;
    background: #f0f0f0;
  }
  h1 { color: #333; }
  button {
    padding: 15px 30px;
    margin: 10px;
    font-size: 1em;
    cursor: pointer;
    border-radius: 8px;
    border: none;
    background: #007bff;
    color: #fff;
    transition: background 0.3s;
  }
  button:hover { background: #0056b3; }
  #qr-reader {
    width: 90%;
    max-width: 400px;
    margin: 20px auto;
    border: 2px solid #ccc;
    border-radius: 12px;
    display: none;
  }
  #result {
    margin: 15px;
    font-size: 1.2em;
    font-weight: bold;
  }
  #result.pass { color: green; }
  #result.denied { color: red; }
  #scan-history {
    list-style: none;
    padding: 0;
    max-height: 250px;
    overflow-y: auto;
    border: 1px solid #ccc;
    margin: 10px auto;
    width: 90%;
    max-width: 400px;
    background: #fff;
    border-radius: 8px;
  }
  #scan-history li {
    padding: 10px;
    border-bottom: 1px solid #eee;
    text-align: left;
  }
</style>

<!-- Html5 QR code scanner library -->
<script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>
</head>
<body>

<h1>QR Code Access Scanner</h1>

<button id="start-scan">üì∑ Scan QR Code</button>
<div id="qr-reader"></div>

<div id="result"></div>

<h3>Scan History</h3>
<ul id="scan-history"></ul>

<script>
  // Allowed QR codes
  const allowedCodes = ["ALLOWED123","VIP_PASS","EMPLOYEE_001"];

  // Scan History
  function addHistory(code, status){
    const ul = document.getElementById("scan-history");
    const li = document.createElement("li");
    const time = new Date().toLocaleTimeString();
    li.textContent = `[${time}] ${code} - ${status}`;
    ul.prepend(li);
  }

  function showResult(status, message, code){
    const resDiv = document.getElementById("result");
    resDiv.textContent = message;
    resDiv.className = status;
    if(code) addHistory(code, message);
  }

  let html5QrCode;
  let scanning = false;

  function onScanSuccess(decodedText){
    html5QrCode.stop().then(() => {
      document.getElementById("qr-reader").style.display = "none";
      scanning = false;
    }).catch(err => console.error(err));

    if(allowedCodes.includes(decodedText)){
      showResult("pass","‚úÖ Access Granted", decodedText);
    } else {
      showResult("denied","‚ùå Access Denied", decodedText);
    }
  }

  function onScanFailure(error){ /* ignore failures */ }

  document.getElementById("start-scan").addEventListener("click", function(){
    if(scanning) return;

    scanning = true;
    const readerDiv = document.getElementById("qr-reader");
    readerDiv.style.display = "block";

    html5QrCode = new Html5Qrcode("qr-reader");

    Html5Qrcode.getCameras().then(cameras => {
      if(cameras && cameras.length){
        const cameraId = cameras[0].id;
        html5QrCode.start(
          cameraId,
          { fps: 10, qrbox: 250 },
          onScanSuccess,
          onScanFailure
        ).catch(err => {
          scanning = false;
          showResult("denied","‚ùå Camera not accessible","");
          console.error(err);
        });
      } else {
        scanning = false;
        showResult("denied","‚ùå No camera found","");
      }
    }).catch(err => {
      scanning = false;
      showResult("denied","‚ùå Cannot access camera","");
      console.error(err);
    });
  });
</script>

</body>
</html>
