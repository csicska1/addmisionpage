<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QR Access Checker</title>
  <script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background: #f4f4f4; }
    #qr-reader { width: 300px; margin: auto; }
    #result { font-size: 2em; margin-top: 20px; }
    #result.pass { color: green; }
    #result.denied { color: red; }
  </style>
</head>
<body>
  <h1>QR Access Checker</h1>
  <div id="qr-reader"></div>
  <div id="result"></div>

  <script>
    // Define allowed QR codes
    const allowedCodes = [
      "ALLOWED123",
      "VIP_PASS",
      "EMPLOYEE_001"
    ];

    function showResult(status, message) {
      const resDiv = document.getElementById('result');
      resDiv.textContent = message;
      resDiv.className = status;
    }

    function onScanSuccess(decodedText, decodedResult) {
      console.log(`Scanned: ${decodedText}`);
      if (allowedCodes.includes(decodedText)) {
        showResult("pass", "✅ Access Granted");
      } else {
        showResult("denied", "❌ Access Denied");
      }
    }

    function onScanFailure(error) {
      // Ignored: QR scanning continuously calls this on failure
      // console.warn(`Scan error: ${error}`);
    }

    const html5QrCode = new Html5Qrcode("qr-reader");
    const config = { fps: 10, qrbox: 250 };

    // Start camera
    Html5Qrcode.getCameras().then(cameras => {
      if (cameras && cameras.length) {
        const cameraId = cameras[0].id;
        html5QrCode.start(cameraId, config, onScanSuccess, onScanFailure)
          .catch(err => {
            console.error("Unable to start QR scanner:", err);
            showResult("denied", "❌ Camera not accessible");
          });
      } else {
        showResult("denied", "❌ No camera found");
      }
    }).catch(err => {
      console.error(err);
      showResult("denied", "❌ Unable to access cameras");
    });
  </script>
</body>
</html>

