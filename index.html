<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>QR Access Manager</title>
<script src="https://unpkg.com/html5-qrcode@2.3.8/minified/html5-qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; padding:20px; text-align:center; }
  h1 { margin-bottom: 5px; }
  .section { background:#fff; padding:20px; margin:20px auto; border-radius:8px; max-width:400px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
  input[type=text]{ width:70%; padding:8px; margin-bottom:10px; }
  button{ padding:8px 15px; cursor:pointer; border:none; background:#007BFF; color:white; border-radius:4px; }
  button:hover{ background:#0056b3; }
  #qr-canvas { margin-top:10px; }
  #qr-reader { width:300px; margin:0 auto; }
  #result { font-size:1.2em; margin-top:10px; font-weight:bold; }
  #result.pass { color:green; }
  #result.denied { color:red; }
  #history { margin-top:20px; text-align:left; max-width:400px; margin-left:auto; margin-right:auto; }
  #history ul{ list-style:none; padding-left:0; }
  #history li{ padding:5px; border-bottom:1px solid #ddd; }
</style>
</head>
<body>

<h1>QR Access Manager</h1>

<div class="section">
  <h2>Generate QR</h2>
  <input type="text" id="qr-text" placeholder="Enter user code" />
  <button onclick="generateQR()">Generate</button>
  <div><canvas id="qr-canvas"></canvas></div>
</div>

<div class="section">
  <h2>Scan QR</h2>
  <div id="qr-reader"></div>
  <div id="result"></div>
</div>

<div class="section" id="history">
  <h2>Scan History</h2>
  <ul id="scan-history"></ul>
</div>

<script>
// ---------- Allowed codes ----------
let allowedCodes = ["ALLOWED123","VIP_PASS","EMPLOYEE_001"];

// ---------- Generate QR ----------
function generateQR(){
  const text = document.getElementById("qr-text").value.trim();
  if(!text){ alert("Enter a code"); return; }
  const canvas = document.getElementById("qr-canvas");
  QRCode.toCanvas(canvas, text, {width:200}, function (error) {
    if(error) console.error(error);
  });
}

// ---------- Scan History ----------
function addHistory(code,status){
  const ul = document.getElementById("scan-history");
  const li = document.createElement("li");
  const time = new Date().toLocaleTimeString();
  li.textContent = `[${time}] ${code} - ${status}`;
  ul.prepend(li);
}

// ---------- Display scan result ----------
function showResult(status,message,code){
  const resDiv = document.getElementById("result");
  resDiv.textContent = message;
  resDiv.className = status;
  addHistory(code,message);
}

// ---------- QR Scanner ----------
function onScanSuccess(decodedText){
  if(allowedCodes.includes(decodedText)){
    showResult("pass","✅ Access Granted",decodedText);
  } else {
    showResult("denied","❌ Access Denied",decodedText);
  }
}

function onScanFailure(error){ /* ignore scan failures */ }

// Initialize scanner
const html5QrCode = new Html5Qrcode("qr-reader");
Html5Qrcode.getCameras().then(cameras => {
  if(cameras && cameras.length){
    const cameraId = cameras[0].id;
    html5QrCode.start(
      cameraId,
      {fps:10, qrbox:250},
      onScanSuccess,
      onScanFailure
    ).catch(err=>{
      showResult("denied","❌ Camera not accessible","");
      console.error(err);
    });
  } else showResult("denied","❌ No camera found","");
}).catch(err=>{
  showResult("denied","❌ Cannot access camera","");
  console.error(err);
});
</script>

</body>
</html>
